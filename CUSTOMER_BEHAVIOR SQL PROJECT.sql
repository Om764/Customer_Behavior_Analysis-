select * from my_table
limit 10;

-- WHAT IS THE TOTAL REVENUE GENERATED BY MALE AND FEMALE

SELECT GENDER, SUM(PURCHASE_AMOUNT) AS REVENUE
FROM MY_TABLE
GROUP BY GENDER;

-- WHICH CUSTOMER USED A DISCOUNT BUT STILL SPENT MORE THEN AVERAGE PURCHASE AMOUNT

SELECT customer_id, GENDER, purchase_amount
FROM MY_TABLE
WHERE discount_applied = 'YES' AND PURCHASE_AMOUNT >= (SELECT AVG(purchase_amount) FROM MY_TABLE);

-- WHICH ARE THE TOP 5 PRODUCT WITH HIGHEST AVERAGE REVIEW RATING

SELECT ITEM_PURCHASED,ROUND(AVG(REVIEW_RATING),2) AS AVERAGE_RATING_OF_REVIEW
FROM MY_TABLE
GROUP BY ITEM_PURCHASED
ORDER BY AVG(REVIEW_RATING) DESC
LIMIT 5;

-- COMPARE THE AVERAGE PURCHASE_AMOUNT BETWEEN STANDARD AND EXPRESS SHIPPING

SELECT SHIPPING_TYPE, ROUND(AVG(PURCHASE_AMOUNT),2) AS AMOUNT_PURCHASED
FROM MY_TABLE
WHERE SHIPPING_TYPE IN ('STANDARD','EXPRESS')
GROUP BY SHIPPING_TYPE;

-- DO SUBSCRIBED CUSTOMER SPEND MORE? COMPARE AVG SPEND AND TOTAL REVENUE BETWEEN SUBSCIBERS AND NON SUBSCIBERS
SELECT SUBSCRIPTION_STATUS, 
COUNT(CUSTOMER_ID) AS TOTAL_CUSTOMERS,
ROUND(AVG(PURCHASE_AMOUNT),2) AS AVG_SPEND,
ROUND(SUM(PURCHASE_AMOUNT),2) AS TOTAL_REVENUE
FROM MY_TABLE
GROUP BY SUBSCRIPTION_STATUS 
ORDER BY TOTAL_REVENUE, AVG_SPEND DESC;

-- WHICH 5 PRODUCT HAVE THE HIGHEST PERCENTAGE OF SALES WITH DISCOUNT APPLIED

SELECT ITEM_PURCHASED,
ROUND(100 * SUM(CASE WHEN DISCOUNT_APPLIED = 'YES' THEN 1 ELSE 0 END) / COUNT(*),2) AS DISCOUNT_PERCENT
FROM MY_TABLE
GROUP BY ITEM_PURCHASED
ORDER BY DISCOUNT_PERCENT DESC
LIMIT 5;

-- segment customers into new , returning and loyal based on the total number of previous purchase and show the count of each segment

WITH CUSTOMER_TYPE AS (
SELECT CUSTOMER_ID, PREVIOUS_PURCHASES,
CASE 
	WHEN PREVIOUS_PURCHASES = 1 THEN 'NEW'
    WHEN PREVIOUS_PURCHASES BETWEEN 2 AND 10 THEN 'RETURNING'
    ELSE 'LOYAL'
    END AS CUSTOMER_SEGMENT
FROM MY_TABLE
)

SELECT CUSTOMER_SEGMENT, COUNT(*) AS TOTAL_CUSTOMERS
FROM CUSTOMER_TYPE
GROUP BY CUSTOMER_SEGMENT;

-- WHAT ARE RHE TOP 3 MOST PURCHASED PRODUCT WITHIN EACH CATEGORY

WITH ITEM_COUNT AS (
SELECT CATEGORY, ITEM_PURCHASED,
COUNT(CUSTOMER_ID) AS TOTAL_CUSTOMERS,
ROW_NUMBER() OVER (PARTITION BY CATEGORY ORDER BY COUNT(CUSTOMER_ID) DESC) AS ITEM_RANK
FROM MY_TABLE
GROUP BY CATEGORY,ITEM_PURCHASED
)

SELECT ITEM_RANK, CATEGORY, ITEM_PURCHASED, TOTAL_CUSTOMERS
FROM ITEM_COUNT
WHERE ITEM_RANK <= 3;

-- ARE CUSTOMERS WHO ARE REPEAT BUYERS ( MORE THAN 5 PREVIOUS PURCHASE) ARE LIKELY TO SUBSCIBERS

SELECT subscription_status, 
COUNT(CUSTOMER_ID) AS REPEAT_BUYERS
FROM MY_TABLE
WHERE PREVIOUS_PURCHASES > 5
GROUP BY subscription_status;

-- WHAT IS THE REVENUE CONTRIBUTED BY EACH GROUP

SELECT AGE_GROUP, SUM(PURCHASE_AMOUNT) AS TOTAL_REVENUE
FROM MY_TABLE
GROUP BY AGE_GROUP
ORDER BY TOTAL_REVENUE DESC;



